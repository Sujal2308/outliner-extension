# ðŸ” API Key Not Working - Debug Guide

## Your API Key

```
AIzaSyDfv3Xgc7b99FJ5FM-LGECugvyRSZ5J9EA
```

- âœ… Length: 39 characters
- âœ… Starts with "AIza"
- âœ… Format is valid

## Quick Fix Steps

### Step 1: Reload Extension

1. Open `chrome://extensions/`
2. Find "Outliner AI"
3. Click the **refresh icon** â†»
4. This reloads the background script with latest changes

### Step 2: Test API Key

Open `test-api-key-save.html` in your browser:

1. Right-click the file â†’ "Open with Chrome"
2. Your API key is already pre-filled
3. Click buttons in order:
   - **1. Validate Format** - Should show âœ… valid
   - **2. Save to Storage** - Saves the key
   - **3. Check Stored Key** - Verifies it's saved
   - **4. Test API Call** - Tests actual Gemini API

### Step 3: Check Console for Errors

**Open Extension Popup:**

1. Click extension icon
2. Right-click popup â†’ "Inspect"
3. Check Console tab for errors

**Check Background Service:**

1. Go to `chrome://extensions/`
2. Find "Outliner AI"
3. Click "Service Worker" link
4. Check Console for API key loaded message

### Step 4: Try Saving Again in Extension

1. Open extension popup
2. Click "âš™ï¸ API Settings"
3. Paste your API key:
   ```
   AIzaSyDfv3Xgc7b99FJ5FM-LGECugvyRSZ5J9EA
   ```
4. Click "Save Key"
5. Should show "âœ… API key saved successfully"

## Common Issues

### Issue 1: Extension Not Reloaded

**Symptom:** Old code still running  
**Fix:** Go to `chrome://extensions/` and click refresh â†»

### Issue 2: Storage Permissions

**Symptom:** Can't save to storage  
**Fix:** Check manifest.json has `"storage"` permission

### Issue 3: Background Script Not Running

**Symptom:** No "Service Worker" link  
**Fix:** Click extension icon to wake it up

### Issue 4: Invalid API Key (if API call fails)

**Symptom:** "401 Unauthorized" error  
**Fix:**

1. Go to [Google AI Studio](https://aistudio.google.com/)
2. Generate a new API key
3. Make sure you're using the correct project

## Test Commands

### Check Storage Manually:

```javascript
// In popup console:
chrome.storage.sync.get("geminiApiKey", (result) => {
  console.log("Stored key:", result.geminiApiKey);
});
```

### Check Background Script:

```javascript
// In background service console:
console.log("API key loaded:", this.apiKey ? "âœ“" : "âœ—");
```

### Force Reload API Key:

```javascript
// In background service console:
backgroundService.loadApiKey();
```

## Expected Behavior

**After saving API key:**

- Status shows: "âœ¨ Gemini API configured (high quality)"
- Method indicator: "GEMINI" (green)
- Placeholder: "API key configured (â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢)"

**When summarizing:**

- Loading shows: "âœ¨ Using Gemini AI..."
- Result shows: "âœ¨ GEMINI" badge
- Summary generated by Gemini API

## If Still Not Working

1. **Clear all storage:**

   ```javascript
   chrome.storage.sync.clear();
   chrome.storage.local.clear();
   ```

2. **Reinstall extension:**

   - Remove extension
   - Reload extension from folder
   - Add API key fresh

3. **Check API key is active:**

   - Visit [Google AI Studio](https://aistudio.google.com/)
   - Check "Get API Key" section
   - Verify key exists and is enabled

4. **Test API directly:**
   - Use `test-api-key-save.html`
   - Click "4. Test API Call"
   - Should get response from Gemini

## Debug Output

When you click "2. Save to Storage" in test page, you should see:

```
Validating API key...
Key length: 39
Starts with "AIza": true
Validation passed!
Attempting to save key to chrome.storage.sync...
Key saved successfully!
Background script confirmed save
```

If you see any RED error messages, that's the problem!

## Need Help?

If none of these work:

1. Take screenshot of console errors
2. Check what step fails in test page
3. Look for any RED error messages
